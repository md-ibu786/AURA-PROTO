---
phase: 02-sidebar-mobile
plan: 02-02
type: execute
---

<objective>
Ensure sidebar auto-closes on all navigation events and wire up ExplorerPage for mobile awareness.

Purpose: Without auto-close, users would need to manually close the sidebar after every navigation on mobile, creating a poor UX. This plan ensures seamless navigation flow: tap item → sidebar closes → content loads.
Output: Updated ExplorerPage.tsx with mobile-aware rendering, confirmed auto-close behavior.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/mobile-responsive/ROADMAP.md
@frontend/src/pages/ExplorerPage.tsx
@frontend/src/stores/useExplorerStore.ts
@frontend/src/components/explorer/SidebarTree.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify auto-close is wired in store navigation actions</name>
  <files>frontend/src/stores/useExplorerStore.ts</files>
  <action>
  Verify that Plan 01-01 correctly added `mobileMenuOpen: false` to all navigation actions in the store. Specifically confirm:

  1. `navigateTo` action sets `mobileMenuOpen: false`
  2. `navigateUp` action (both branches) sets `mobileMenuOpen: false`
  3. `setCurrentPath` action sets `mobileMenuOpen: false`
  4. `reset()` includes `mobileMenuOpen: false`

  If any of these are missing, add them. The SidebarTree component calls `navigateTo` when clicking tree items, which means the sidebar will auto-close when a user taps a folder in the tree on mobile.

  No additional code is needed in SidebarTree.tsx — it already calls `navigateTo` from the store, which handles the auto-close.
  </action>
  <verify>Read the store file and confirm all 4 navigation actions include `mobileMenuOpen: false`</verify>
  <done>All navigation actions auto-close the mobile menu</done>
</task>

<task type="auto">
  <name>Task 2: Update ExplorerPage to handle backdrop rendering location</name>
  <files>frontend/src/pages/ExplorerPage.tsx</files>
  <action>
  The ExplorerPage renders Sidebar as a direct child. Since Sidebar.tsx now renders a Fragment with backdrop + aside, verify that ExplorerPage's layout still works correctly.

  Check the `handleBackgroundClick` function — it currently closes the context menu when clicking the background. This should NOT interfere with the sidebar backdrop click handler because:
  - The sidebar backdrop has its own `onClick` handler that calls `setMobileMenuOpen(false)`
  - The backdrop has `z-index: 99` which is above the main content
  - Event propagation from the backdrop won't reach `.explorer-layout`

  No changes should be needed to ExplorerPage.tsx if the Sidebar component correctly wraps its output in a Fragment. Verify this is the case, and if any issues are found, fix them.

  If changes are needed (e.g., the Fragment approach creates layout issues), adjust the Sidebar component to move the backdrop into the ExplorerPage instead.
  </action>
  <verify>Run `cd frontend && npx tsc --noEmit` and `cd frontend && npm run build` to confirm everything works</verify>
  <done>ExplorerPage renders correctly with the updated Sidebar, no layout issues, build passes</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd frontend && npx tsc --noEmit` passes
- [ ] `cd frontend && npm run build` passes
- [ ] Navigating to a folder via SidebarTree closes the mobile menu
- [ ] navigateUp closes the mobile menu
- [ ] Going home closes the mobile menu
- [ ] No layout issues with ExplorerPage
</verification>

<success_criteria>
- Navigation flow works: tap tree item → sidebar closes → content loads
- No user action required to dismiss sidebar after navigation
- Desktop behavior completely unaffected
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/mobile-responsive/phases/02-sidebar-mobile/02-02-SUMMARY.md`
</output>
