---
phase: 01-infrastructure-config
type: execute
---

<objective>
Create and configure a Firebase project for AURA-NOTES-MANAGER production deployment.

Purpose: This phase establishes the production infrastructure foundation that all subsequent phases depend on. Without proper Firebase project setup, authentication and database features cannot function.
Output: Configured Firebase project with Authentication and Firestore enabled, service account key downloaded and properly secured.
</objective>

<execution_context>
@~/.Opencode/skills/create-plans/workflows/execute-phase.md
@~/.Opencode/skills/create-plans/templates/summary.md
@~/.Opencode/skills/create-plans/references/checkpoints.md
</execution_context>

<context>
@.planning/firebase-rbac-migration/BRIEF.md
@.planning/firebase-rbac-migration/ROADMAP.md
@FIREBASE_RBAC_MIGRATION_PLAN.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Create Firebase Project</name>
  <action>
    1. Go to https://console.firebase.google.com/
    2. Click "Create a project" or "Add project"
    3. Enter project name: "aura-notes-manager" (or preferred name)
    4. Accept Firebase terms and Google Analytics terms (if prompted)
    5. Choose whether to enable Google Analytics (optional for this project)
    6. Wait for project creation to complete (may take 1-2 minutes)
  </action>
  <verify>
    After completion, you should see the Firebase project dashboard with your new project name.
    Note the Project ID displayed in the top-left (format: aura-notes-manager-XXXXX).
  </verify>
  <done>Firebase project created and Firebase Console dashboard accessible</done>
  <resume-signal>Type "done" when Firebase project is created and you can see the dashboard</resume-signal>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Enable Firebase Authentication</name>
  <action>
    1. In Firebase Console, click "Authentication" in the left sidebar (under Build section)
    2. Click "Get started"
    3. Click "Sign-in method" tab
    4. Find "Email/Password" provider and click it
    5. Toggle "Enable" to ON
    6. Leave "Email link (passwordless sign-in)" disabled for now
    7. Click "Save"
    8. Wait for the provider to show as "Enabled" in the list
  </action>
  <verify>
    Email/Password provider should show "Enabled" status in the Sign-in method list.
  </verify>
  <done>Email/Password authentication provider enabled</done>
  <resume-signal>Type "done" when Email/Password sign-in is enabled</resume-signal>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 3: Enable Cloud Firestore</name>
  <action>
    1. In Firebase Console, click "Firestore Database" in the left sidebar (under Build section)
    2. Click "Create database"
    3. Choose "Start in production mode" (NOT test mode - we want deny-by-default security)
    4. Click "Next"
    5. Choose your region:
       - For US users: "nam5 (us-central)"
       - For Europe users: "europe-west1"
       - For Asia users: "asia-northeast1"
    6. Click "Enable"
    7. Wait for Firestore to be created (this may take 2-3 minutes)
  </action>
  <verify>
    You should see the Firestore Database console with an empty database and default security rules.
  </verify>
  <done>Cloud Firestore database created and ready</done>
  <resume-signal>Type "done" when Firestore database is created</resume-signal>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 4: Download Service Account Key</name>
  <action>
    1. Click the gear icon (⚙️) next to "Project Overview" and select "Project settings"
    2. Go to the "Service accounts" tab
    3. Click "Generate new private key" button
    4. Click "Generate key" in the confirmation dialog
    5. A JSON file will download (e.g., "aura-notes-manager-firebase-adminsdk-XXXXX.json")
    6. Rename it to "serviceAccountKey.json"
    7. Move it to the project root: D:\Peter\AURA Twin Proj\AURA-PROJ\AURA-NOTES-MANAGER\serviceAccountKey.json
    8. NEVER commit this file to git - it contains private credentials
  </action>
  <verify>
    Check that serviceAccountKey.json exists in the project root directory.
  </verify>
  <done>Service account key downloaded and placed in project root as serviceAccountKey.json</done>
  <resume-signal>Type "done" when service account key is downloaded and moved to project root</resume-signal>
</task>

<task type="auto">
  <name>Task 5: Update .gitignore for Service Account</name>
  <files>.gitignore</files>
  <action>
    Add serviceAccountKey.json to .gitignore to prevent accidental commits.
    Add also any other Firebase-related sensitive files:
    - serviceAccountKey*.json
    - *adminsdk*.json
    - .env.firebase (if you create it later)
    
    DO NOT commit credentials files - this is a critical security vulnerability.
  </action>
  <verify>
    Run: git check-ignore serviceAccountKey.json
    Should output: serviceAccountKey.json
  </verify>
  <done>serviceAccountKey.json added to .gitignore and git properly ignores it</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 6: Configure Service Account Permissions</name>
  <action>
    1. Go to https://console.cloud.google.com/ (Google Cloud Console - linked to your Firebase project)
    2. Select your Firebase project from the dropdown
    3. Go to "IAM & Admin" → "IAM" in the left sidebar
    4. Find the service account (format: firebase-adminsdk-XXXXX@aura-notes-manager.iam.gserviceaccount.com)
    5. Click the pencil/edit icon next to it
    6. Verify these roles are assigned (add if missing):
       - "Firebase Admin SDK Administrator Service Agent" (usually auto-assigned)
       - "Cloud Datastore User" (for Firestore access)
    7. If any role is missing, click "Add another role" and add it
    8. Click "Save"
  </action>
  <verify>
    Service account should have at minimum:
    - Firebase Admin SDK Administrator Service Agent
    - Cloud Datastore User
  </verify>
  <done>Service account has required IAM permissions for Firebase Admin SDK and Firestore</done>
  <resume-signal>Type "done" when service account has proper IAM roles</resume-signal>
</task>

<task type="auto">
  <name>Task 7: Document Project Configuration</name>
  <files>api/config.py, .env.example</files>
  <action>
    Update .env.example to include Firebase configuration variables:
    - USE_REAL_FIREBASE=false
    - FIREBASE_CREDENTIALS=./serviceAccountKey.json
    - FIREBASE_PROJECT_ID=your-project-id
    
    Also add a comment in .env.example about serviceAccountKey.json:
    # IMPORTANT: Copy serviceAccountKey.json from Firebase Console
    # DO NOT commit this file to version control
    
    Note: Do NOT create or modify actual .env file with real values - that's for the next plan.
    Only update .env.example template here.
  </action>
  <verify>
    Read .env.example and verify Firebase configuration variables are present.
  </verify>
  <done>.env.example updated with Firebase configuration template and security warnings</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Firebase project created and accessible at console.firebase.google.com
- [ ] Email/Password authentication provider enabled
- [ ] Cloud Firestore database created in production mode
- [ ] serviceAccountKey.json downloaded and in project root
- [ ] serviceAccountKey.json properly added to .gitignore
- [ ] Service account has Firebase Admin SDK and Cloud Datastore User roles
- [ ] .env.example updated with Firebase configuration variables
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Firebase infrastructure ready for development
- Service account credentials secured (not in git)
- No credentials exposed in committed files
</success_criteria>

<output>
After completion, create `.planning/firebase-rbac-migration/phases/01-infrastructure-config/01-01-SUMMARY.md`
</output>
