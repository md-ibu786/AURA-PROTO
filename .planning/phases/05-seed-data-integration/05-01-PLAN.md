---
phase: 05-seed-data-integration
plan: 05-01
type: execute
---

<objective>
Create seed script and update environment configuration for auth system.

Purpose: Provide test users and configuration for development.
Output: Seed script and updated .env configuration.
</objective>

<execution_context>
@~/.Opencode/skills/create-plans/workflows/execute-phase.md
@~/.Opencode/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@AUTHENTICATION_DOCUMENTATION.md
@api/mock_firestore.py
@.env.template
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create seed_users.py script</name>
  <files>tools/seed_users.py</files>
  <action>
Create `tools/seed_users.py` to seed test users:

```python
"""
============================================================================
FILE: seed_users.py
LOCATION: tools/seed_users.py
============================================================================

PURPOSE:
    Seed script to populate test users in Firestore for development.

USAGE:
    python tools/seed_users.py
============================================================================
"""

import os
import sys

# Add parent directory to path for imports
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

from datetime import datetime


def get_seed_users():
    """Return list of seed users for development."""
    now = datetime.utcnow().isoformat() + "Z"
    
    return [
        {
            "id": "mock-admin-001",
            "email": "admin@test.com",
            "displayName": "Test Admin",
            "role": "admin",
            "departmentId": None,
            "subjectIds": None,
            "status": "active",
            "password": "Admin123!",
            "createdAt": now,
            "updatedAt": now
        },
        {
            "id": "mock-staff-001",
            "email": "staff@test.com",
            "displayName": "Test Staff",
            "role": "staff",
            "departmentId": "dept-cs-001",
            "subjectIds": ["subject-001", "subject-002"],
            "status": "active",
            "password": "Staff123!",
            "createdAt": now,
            "updatedAt": now
        },
        {
            "id": "mock-student-001",
            "email": "student@test.com",
            "displayName": "Test Student",
            "role": "student",
            "departmentId": "dept-cs-001",
            "subjectIds": None,
            "status": "active",
            "password": "Student123!",
            "createdAt": now,
            "updatedAt": now
        }
    ]


def seed_mock_db():
    """Seed users into MockFirestoreClient."""
    from api.mock_firestore import MockFirestoreClient
    
    db = MockFirestoreClient()
    users = get_seed_users()
    
    print("Seeding users to mock database...")
    for user in users:
        user_id = user.pop("id")
        db.collection("users").document(user_id).set(user)
        print(f"  Created: {user['email']} ({user['role']})")
    
    print(f"\nSeeded {len(users)} users successfully!")
    return users


def seed_firestore():
    """Seed users into real Firestore."""
    try:
        from api.config import db
        
        users = get_seed_users()
        
        print("Seeding users to Firestore...")
        for user in users:
            user_id = user.pop("id")
            db.collection("users").document(user_id).set(user)
            print(f"  Created: {user['email']} ({user['role']})")
        
        print(f"\nSeeded {len(users)} users successfully!")
        return users
        
    except Exception as e:
        print(f"Error seeding Firestore: {e}")
        print("Falling back to mock database...")
        return seed_mock_db()


def main():
    """Main entry point."""
    use_real = os.environ.get("USE_REAL_FIREBASE", "false").lower() == "true"
    
    if use_real:
        seed_firestore()
    else:
        seed_mock_db()


if __name__ == "__main__":
    main()
```

AVOID: Hardcoding absolute paths.
WHY: Script should work from any directory.
  </action>
  <verify>python tools/seed_users.py 2>&1 | head -10</verify>
  <done>seed_users.py runs and seeds users</done>
</task>

<task type="auto">
  <name>Task 2: Update .env.template with auth variables</name>
  <files>.env.template</files>
  <action>
Add authentication-related environment variables to `.env.template`:

```bash
# =============================================================================
# Authentication Configuration
# =============================================================================
# Set to "true" to use real Firebase Auth, "false" for mock auth (local dev)
USE_REAL_FIREBASE=false

# Firebase credentials path (only needed if USE_REAL_FIREBASE=true)
# FIREBASE_CREDENTIALS=serviceAccountKey.json
```

Add this section near the top of the file, after any existing Firebase configuration.

AVOID: Setting USE_REAL_FIREBASE=true by default.
WHY: Local development should work without Firebase credentials.
  </action>
  <verify>grep -q "USE_REAL_FIREBASE" .env.template && echo "Variable exists"</verify>
  <done>USE_REAL_FIREBASE added to .env.template</done>
</task>

<task type="auto">
  <name>Task 3: Create test credentials reference file</name>
  <files>TEST_CREDENTIALS.md</files>
  <action>
Create `TEST_CREDENTIALS.md` in project root:

```markdown
# Test Credentials

## Mock Authentication Users

These accounts work when `USE_REAL_FIREBASE=false` (default for local development).

| Role | Email | Password |
|------|-------|----------|
| Admin | admin@test.com | Admin123! |
| Staff | staff@test.com | Staff123! |
| Student | student@test.com | Student123! |

## Role Permissions

| Role | View All Depts | Upload Notes | Manage Users |
|------|----------------|--------------|--------------|
| Admin | Yes | No | Yes |
| Staff | Own Dept Only | Own Dept Only | No |
| Student | Own Dept Only | No | No |

## Running with Mock Auth

1. Ensure `.env` has: `USE_REAL_FIREBASE=false`
2. Start backend: `cd api && python -m uvicorn main:app --reload --port 8000`
3. Start frontend: `cd frontend && npm run dev`
4. Login at: http://localhost:5173/login

## Notes

- Mock auth stores tokens in localStorage as `auth_token`
- Mock tokens format: `mock-token-{role}-{uid}`
- No real Firebase credentials required for local development
```

AVOID: Including real credentials.
WHY: This is a public reference file.
  </action>
  <verify>test -f TEST_CREDENTIALS.md && echo "File exists"</verify>
  <done>TEST_CREDENTIALS.md created</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python tools/seed_users.py` runs without errors
- [ ] `.env.template` contains USE_REAL_FIREBASE variable
- [ ] TEST_CREDENTIALS.md exists with test account info
- [ ] Seed script creates 3 test users (admin, staff, student)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Developers can quickly find test credentials
- Seed script works for both mock and real Firestore
</success_criteria>

<output>
After completion, create `.planning/phases/05-seed-data-integration/05-01-SUMMARY.md`
</output>
